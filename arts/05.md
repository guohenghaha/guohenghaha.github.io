---
layout: page
title: arts 05
permalink: /arts-05/
---

### 排查 bug 对自我的要求 

1. 发现问题的本质原因，而非表象原因。发现本质原因会更困难，但是值得去做。在目前团队学到的做事方式是做结论之前要缜密的思考，而非着急只是把事情解决。比如遇到的某个电子搜索接口慢的问题时，表象的原因时某个 rpc 太慢拖慢了整体的响应速度，对应的解决方案是优化单个 rpc 接口。但是沉下心去问自己为何 rpc 慢，最终发现时因为 rpc 接口设计复杂，嵌套的资源太多导致接口随着迭代逐渐恶化，所以对应的解决方案是重新设计 rpc 的接口设计，把嵌套的资源解开，这样 rpc 的响应时间自然就降低了。
2. 举一反三思考，系统中是否有类似的问题。比如买单中有遇到用户支付成功但是订单被取消的问题。那么在解决了这个问题之后需要举一反三去思考，其他订单是否也有类似问题呢？这样解决问题才可以达到以点带面的目的。
3. 反思下次是否可以更快定位到问题。比如在排查接口性能问题的时候，用 pyinstrument 这种工具是否比 print 时间更好定位到性能瓶颈呢？

### 如何检查 sql 结果

在目前的团队，上线一个 feature 之后需要工程师写 sql 去核对效果。在业务复杂的场景中，写对 sql 还是挺难的，需要注意各种过滤条件。如何核对 sql 正确性，踩坑之后总结了几点：

1. 微观上检查，把每一列数据排序看下，是否有特殊数据（比如 null）
2. 随机抽查几条数据，通过其他手段交叉验证下正确性
3. 宏观上验证，看下数量级有无问题

这样检查之后，基本上可以避免大部分问题。

### 推动事情未成的想法啊

上个周本想推动异步任务从 celery 迁移到 k8s，但是被技术老大拒绝了。原因是他认为这个问题还没到影响开发效率和给业务拖后腿的地步，所以暂时没安排。这个是可以理解的，因为公司 ops 人力紧张，我在他那个位子上肯定也把精力放在更紧急和重要的事情上。

这个事情给我的启发是，推动事情的时候要给利益相关人说出明确的痛点和解决方案的可量化的优势，否则很难打动人。另外，推动事情的时机也很重要，在适当的时候去推动，阻力会更小。比如在推动简化 rpc 接口的时候挑选在接口性能恶化的时机就非常轻松，所以顺势而为非常重要。

### 做决策的思考

在做工单系统的时候，由于一个地方需要前端配合解决，否则整体方案会有小瑕疵，但是当前并没有前端资源。当时开会的时候 Leader 询问了「小瑕疵」造成的影响，发现这种 case 特别少，所以认为第一期先不去管也没关系，所以可以先把其他部分做了。这种做决策的思路挺好的，权衡之后接受不完美，但是可以推动事情顺利往下走。

做决策时如果对于业务上的问题不确认，需要向业务专家搞清楚。比如我在做用户标签时，本来打算删除历史上重复删除的名单，因为我认为删除的是重复的标签，那么应该没有人使用了，后面向客服专家询问之后，发现他们确实有使用场景，所以在做方案的时候需要把这部分数据保留。
