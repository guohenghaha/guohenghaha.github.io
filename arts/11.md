---
layout: page
title: arts 11
permalink: /arts-11/
---

## join 语句优化

最近线上遇到一个 SQL 没有正确使用索引的 case，导致 SQL 扫描了百万行数据。具体原因是 MySQL 选错了索引，具体原因是 MySQL 内部有一套算法来选择“最优”的索引（索引区分度，是否排序，是否使用临时表等等）。解决这种问题办法有两个：

1. 改写查询，让 MySQL 选择正确索引
2. 采用 force index 指定索引

## 向上管理，争取资源

有些时候想做一块事情，如何争取老板的同意很重要，以为开发团队永远是活多人少，所以要知道如何打动/说服老板。

从我的角度来看，和老板沟通这种事情的时候，需要注意三个点：
1. 说明如果这个事情不做的潜在危害。比如我在沟通优化某个接口速度的时候，指名这个接口速度慢是由于现在某处架构的问题，如果不优化很可能影响最近主推的一块业务。那么老板就肯定引起注意，提高这个事情的优先级。
2. 自己做一些准备，列一下大概的方案，这样自己和老板心里都大概有个谱，不能说提出的问题没有解决方案。
3. 大概的估期和排期规划，让老板知道开发成本

## 不要非黑即白

今天和产品在讨论一个方案的时候，当时有两套方案产生了分歧，一套的出发点是从仓库流转效率和成本的角度友好，一块对用户感受和传达友好。当时这里讨论了二十分钟没有结论，最后产品提出了一个综合的方案可以兼顾这两点，从而扭转了讨论的局势，这个思维方式很重要。

## 如何避免 big merge request

最近提了两次 2K 行左右的 big merge request，使得自己和 reviewer 都很痛苦，所以总结了下如何避免 big merge request 的方案分享给了团队，大概思路是把大功能拆解为独立的小功能，并且配合特性开关使得代码部署和功能上线相分离。具体做法是拆解之后的小功能可以先合并到主干分支合并上线，但是没有打开特性开关使得这部分代码不会执行，这样保持每个 mr 都比较小，最终功能上线的时候只需要打开特性开关即可。

## 阅读

最近在读 DK 出版的《商业百科》，还不错。